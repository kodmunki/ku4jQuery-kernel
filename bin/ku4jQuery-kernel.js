//kodmunki utilities
(function(w){w.isArray=function(P){return P instanceof Array};w.isBool=function(P){return(/boolean/i.test(typeof(P)))};w.isDate=function(P){return P instanceof Date};w.isEvent=function(P){try{return P instanceof Event}catch(Q){return P===window.event}};w.isNumber=function(P){return(/number/i.test(typeof(P)))&&!isNaN(P)};w.isObject=function(P){return w.exists(P)&&(/object/i.test(typeof(P)))};w.isFunction=function(P){return(P instanceof Function)};w.isString=function(P){return(/string/i.test(typeof(P)))||P instanceof String};w.isZero=function(P){return P===0};w.isEven=function(P){return(w.isNullOrEmpty(P)||w.isDate(P))?false:(isNaN(P)?false:(w.isZero(P)?false:P%2===0))};w.isOdd=function(P){return(w.isNullOrEmpty(P)||w.isDate(P))?false:(isNaN(P)?false:(w.isZero(P)?false:!w.isEven(P)))};w.isNull=function(P){return P===null};w.isUndefined=function(P){return(/undefined/i.test(typeof(P)))};w.isEmpty=function(P){return w.isString(P)&&w.isZero(P.split(/\B/).length)};w.isNullOrEmpty=function(P){return !w.exists(P)||w.isEmpty(P)};w.exists=function(P){return(P!==null)&&(!w.isUndefined(P))};w.xor=function(Q,P){return !Q!=!P};w.replicate=function(R){var P=(w.isDate(R))?new Date(R):(w.isArray(R))?[]:(w.isObject(R))?{}:R,Q;for(n in R){Q=R[n];P[n]=((w.isArray(Q))||(w.isObject(Q)))?w.replicate(Q):Q}return P};if(!w.exists(w.obj)){w.obj={}}w.obj.keys=function(Q){var P=[];for(n in Q){P[P.length]=n}return P};w.obj.values=function(Q){var P=[];for(n in Q){P[P.length]=Q[n]}return P};w.obj.count=function(P){var Q=0;for(n in P){Q++}return Q};w.obj.hasProp=function(P,Q){return(w.exists(P.hasOwnProperty))?P.hasOwnProperty(Q):false};w.obj.merge=function(Q,P){var R=w.replicate(P);for(n in Q){R[n]=Q[n]}return R};w.obj.meld=function(R,Q){var P=w.replicate(Q);for(n in R){if(w.exists(P[n])){continue}P[n]=R[n]}return P};w.Class=function(){};w.Class.prototype={get:function(P){return this["_"+P]},set:function(Q,P){this["_"+Q]=P;return this},property:function(Q,P){return(w.isUndefined(P))?this.get(Q):this.set(Q,P)}};w.Class.extend=function(Q,P){if(!Q||!P){return null}var R=function(){};R.prototype=P.prototype;Q.base=P;Q.prototype=w.obj.merge(Q.prototype,new R());Q.prototype.constructor=Q;return Q};function d(P){d.base.call(this);this._isLocked=P||false}d.prototype={isLocked:function(){return this.get("isLocked")},lock:function(){this._isLocked=true;return this},unlock:function(){this._isLocked=false;return this}};w.Class.extend(d,w.Class);w.lock=function(P){return new d(P)};if(!w.exists(w.math)){w.math={}}w.math.round=function(S,R){var Q=R||0,P=Math.pow(10,-Q);return Math.round(parseFloat((S*P).toFixed(Math.abs(Q))))/P};w.math.roundUp=function(S,R){var Q=R||0,P=5*(Math.pow(10,Q-1));return w.math.round(S+P,R)};w.math.roundDown=function(S,R){var Q=R||0,P=5*(Math.pow(10,Q-1));return w.math.round(S-P,R)};w.math.factorial=function(R){var P=R,Q=R;while(Q--){if(!!Q){P*=Q}}return P};w.math.divide=function(Q,P){var R=w.isNumber(Q)&&w.isNumber(P)&&!w.isZero(P);if(!R){throw new Error(w.str.format("Invalid division. value: {0}/{1} | type: {2}/{3}",Q,P,typeof Q,typeof P))}return Q/P};if(!w.exists(w.str)){w.str={}}var K="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";w.str.build=function(){return"".concat.apply(new String(),arguments)};w.str.format=function(){var R=arguments,U=R[0],Q=R.length,P,T;for(i=1;i<Q;i++){P=R[i];T=(w.isNull(P))?"null":(w.isUndefined(P))?"undefined":P.toString();U=U.replace(RegExp("\\{"+(i-1)+"\\}","g"),T)}return U};w.str.parse=function(){return String.fromCharCode.apply(String,arguments)};w.str.trim=function(P){return w.str.trimStart(w.str.trimEnd(P))};w.str.trimStart=function(P){if(!w.isString(P)){throw new Error("Cannot trim non-string values")}return(w.exists(P.replace))?P.replace(/^\s*\b/,""):P};w.str.trimEnd=function(P){if(!w.isString(P)){throw new Error("Cannot trim non-string values")}return(w.exists(P.replace))?P.replace(/\b\s*$/,""):P};w.str.encodeBase64=function(S){var T="",R=0,aa=w.str.encodeUtf8(S),ab,Y,W,Z,X,V,U,P=function(ac){return aa.charCodeAt(ac)},Q=function(ac){return K.charAt(ac)};while(R<aa.length){ab=P(R++);Y=P(R++);W=P(R++);Z=ab>>2;X=((ab&3)<<4)|(Y>>4);V=((Y&15)<<2)|(W>>6);U=W&63;if(isNaN(Y)){V=U=64}else{if(isNaN(W)){U=64}}T+=(Q(Z)+Q(X)+Q(V)+Q(U))}return T};w.str.decodeBase64=function(S){var T="",R=0,aa=S.replace(/[^A-Za-z0-9\+\/\=]/g,""),ab,Y,W,Z,X,V,U,Q=function(ac){return K.indexOf(aa.charAt(ac))},P=function(ac){return String.fromCharCode(ac)};while(R<aa.length){Z=Q(R++);X=Q(R++);V=Q(R++);U=Q(R++);ab=(Z<<2)|(X>>4);Y=((X&15)<<4)|(V>>2);W=((V&3)<<6)|U;T+=P(ab);if(V!=64){T+=P(Y)}if(U!=64){T+=P(W)}}return w.str.decodeUtf8(T)};w.str.encodeUtf8=function(P){var U="",S=P.replace(/\r\n/g,"\n"),T=function(W){return S.charCodeAt(W)},R=function(W){return String.fromCharCode(W)};for(var Q=0;Q<S.length;Q++){var V=T(Q);if(V<128){U+=R(V)}else{if((V>127)&&(V<2048)){U+=(R((V>>6)|192)+R((V&63)|128))}else{U+=R((V>>12)|224)+R(((V>>6)&63)|128)+R((V&63)|128)}}}return U};w.str.decodeUtf8=function(V){var W="",T=0,U=0,S=0,R=0,X=V,P=function(Y){return X.charCodeAt(Y)},Q=function(Y){return String.fromCharCode(Y)};while(T<X.length){U=P(T);if(U<128){W+=Q(U);T++}else{if((U>191)&&(U<224)){S=P(T+1);W+=Q(((U&31)<<6)|(S&63));T+=2}else{S=P(T+1);R=P(T+2);W+=Q(((U&15)<<12)|((S&63)<<6)|(R&63));T+=3}}}return W};w.kuid=function(R){var Q=R||"kuid",P=Math.random().toString().replace(/\b\.\b/,"");return w.str.format("{0}{1}",Q,P)};function H(P){H.base.call(this);var Q=(!w.exists(P)||!P.toObject)?P:P.toObject();this.$h=(w.exists(Q))?Q:{};this._count=0;for(n in this.$h){this._count++}}H.prototype={count:function(){return this.get("count")},add:function(Q,P){if(!w.exists(Q)||this.containsKey(Q)){return this}this.$h[Q]=P;this._count++;return this},clear:function(){var P=this.$h;for(n in P){delete P[n]}this._count=0;return this},find:function(P){if(!w.exists(P)){return null}return this.$h[P]},findKey:function(P){if(!w.exists(P)){return null}var Q=this.$h;for(n in Q){if(Q[n]==P){return n}}return null},findValue:function(P){return this.find(P)},quit:function(){this._iterator.quit();return this},each:function(Q,P){var R=P||this;this._iterator=w.iterator(this.toObject());this._iterator.each(Q,R);return this},isEmpty:function(){return this._count<1},listKeys:function(){return new w.list(w.obj.keys(this.$h))},listValues:function(){return new w.list(w.obj.values(this.$h))},containsKey:function(P){if(!w.exists(P)){return false}return w.exists(this.$h[P])},containsValue:function(Q){var P=w.obj.values(this.$h),R=P.length;while(R--){if(P[R]==Q){return true}}return false},merge:function(P){return G(this,P,"merge")},meld:function(P){return G(this,P,"meld")},remove:function(P){var Q=this.$h;if(!w.exists(P)||!w.exists(Q[P])){return this}delete Q[P];this._count--;return this},replicate:function(){return w.hash(w.replicate(this.$h))},toObject:function(){return this.$h},update:function(Q,P){if(!w.exists(Q)){return this}if(!this.containsKey(Q)){this._count++}this.$h[Q]=P;return this}};w.Class.extend(H,w.Class);function G(R,Q,P){var S=(!Q.toObject)?Q:Q.toObject();R.$h=w.obj[P](S,R.$h);R._count=w.obj.count(R.$h);return R}w.hash=function(P){return new H(P)};w.hash.Class=H;function r(Q){r.base.call(this);this._keys=[];this._hash=w.hash();this._count=this._keys.length;if(!w.exists(Q)){return}var R=0,P=Q.length;while(R<P){this.add(Q[R]);R++}}r.prototype={count:function(){return this.get("count")},add:function(Q){var P=this._keys,R=w.uid();P[P.length]=R;this._hash.add(R,Q);this._count=this._keys.length;return this},clear:function(){this._hash.clear();this._keys=[];this._count=this._keys.length;return this},contains:function(P){return this._hash.containsValue(P)},find:function(Q){var P=this._keys;return(w.exists(P[Q]))?this._hash.find(P[Q]):null},quit:function(){this._iterator.quit();return this},each:function(Q,P){var R=P||this;this._iterator=w.iterator(this.toArray());this._iterator.each(Q,R);return this},isEmpty:function(){return this._count<1},remove:function(R){var Q=this._hash,P;if(!this.contains(R)){return this}P=Q.findKey(R);this._keys.splice(P,1);Q.remove(P);this._count=Q.count();return this},toArray:function(){var P=[];this._hash.each(function(Q){P.push(Q.value)});return P},sort:function(P){var R=this.toArray().sort(P);this.clear();var S=0,Q=R.length;while(S<Q){this.add(R[S]);S++}return this}};w.Class.extend(r,w.Class);w.list=function(P){return new r(P)};w.list.Class=r;w.list.parseArguments=function(P){return new r(Array.prototype.slice.call(P))};function J(U,S,P,V,R,W,Q){if((S<1)||(S>12)){throw new w.exception("arg","Invalid month at $.dayPoint")}if((P<1)||(P>N(S,U))){throw new w.exception("arg","Invalid date at $.dayPoint")}this._value=(arguments.length>=3)?new Date(U,S-1,P,V||0,R||0,W||0,Q||0):new Date();var X=this._value;function Y(Z){return Z<10?"0"+Z:""+Z}this._day=X.getDay();this._date=P;this._month=S;this._year=U;this._hour=Y(X.getHours());this._minute=Y(X.getMinutes());this._second=Y(X.getSeconds());this._millisecond=Y(X.getMilliseconds());var T=this._day;this._isWeekday=T>0&&T<6;this._isWeekend=!this._isWeekday}J.prototype={value:function(){return this._value},day:function(){return this._day},date:function(){return this._date},month:function(){return this._month},year:function(){return this._year},hour:function(){return this._hour},minute:function(){return this._minute},second:function(){return this._second},millisecond:function(){return this._millisecond},isWeekday:function(){return this._isWeekday},isWeekend:function(){return this._isWeekend},equals:function(P){return this._value==P.value()},nextDay:function(){return O(this,1,0,0)},prevDay:function(){return O(this,-1,0,0)},nextMonth:function(){return O(this,0,1,0)},prevMonth:function(){return O(this,0,-1,0)},nextYear:function(){return O(this,0,0,1)},prevYear:function(){return O(this,0,0,-1)},add:function(U,P,Z){function Y(ab,af,ae){var ac=ab,ad=af;while(ad--){ac=ac[ae]()}return ac}var X=U<0,aa=Math.abs,W=aa(U),V=aa(Z),R=aa(P),Q=X?"prevYear":"nextYear",T=X?"prevDay":"nextDay",S=X?"prevMonth":"nextMonth";return Y(Y(Y(this,W,Q),R,S),V,T)},firstDayOfMonth:function(){return new J(this._year,this._month,1)},lastDayOfMonth:function(){return new J(this._year,this._month,N(this._month,this._year))},isBefore:function(P){return !(this.isAfter(P)||this.equals(P))},isAfter:function(Q){var P=this._year,S=Q.year(),R=this._month,T=Q.month();if(P>S){return true}if((P==S)&&(R>T)){return true}if((P==S)&&(R==T)&&(this._date>Q.date())){return true}return false},equals:function(P){return(this._year==P.year())&&(this._month==P.month())&&(this._date==P.date())},toString:function(){var S=this._year,P=this._month,R=this._date,Q=(P<10&&R<10)?"0{1}/0{2}/{0}":(P<10)?"0{1}/{2}/{0}":(R<10)?"{1}/0{2}/{0}":"{1}/{2}/{0}";return w.str.format(Q,S,P,R)},toDate:function(){return this.value()}};w.dayPoint=function(T,U,R,P,S,V,Q){if(!(w.isDate(T)||(w.isNumber(T)&&w.isNumber(U)&&w.isNumber(R)))){return null}return new J(T,U,R,P,S,V,Q)};w.dayPoint.canParse=function(P){return(w.isString(P)||w.isNumber(P)||w.isDate(P))?!isNaN(new Date(P).valueOf()):false};w.dayPoint.parse=function(W){if(W instanceof J){return W}if(!(w.isDate(W)||this.canParse(W))){return null}var P=new Date(W),V=P.getFullYear(),R=P.getMonth()+1,U=P.getDate(),S=P.getHours(),T=P.getMinutes(),X=P.getSeconds(),Q=P.getMilliseconds();return w.dayPoint(V,R,U,S,T,X,Q)};w.dayPoint.tryParse=function(P){return w.dayPoint.canParse(P)?w.dayPoint.parse(P):null};var F;w.dayPoint.assumeNow=function(P){F=w.dayPoint.parse(P)};w.dayPoint.today=function(){return F||w.dayPoint.parse(new Date())};function N(R,Q){var P=R,S=Q;if(P==2){return(p(S))?29:28}return(((P<8)&&(w.isEven(P)))||((P>7)&&(w.isOdd(P))))?30:31}function p(P){var R=P.toString().split(/\B/),Q=parseFloat(w.str.build(R[R.length-2],R[R.length-1]));return(Q%4==0)}function O(V,aa,R,ac){var ae=V.month(),W=V.year(),T=V.date(),P=N(ae,W),ad=aa,U=R,Z=ac,Q=T+ad,Y=ae+U,ab=W+Z;if((T+ad)>P){Q=1;Y=(ae+(U+1))}if((T+ad)<1){var S=V.prevMonth(),Q=N(S.month(),S.year());(Y=ae+(U-1))}if((Y)>12){Y=1;ab=(W+(Z+1))}if((Y)<1){Y=12;ab=(W+(Z-1))}var X=N(Y,ab);Q=(Q>X)?X:Q;return new J(ab,Y,Q)}function D(U,R){if(isNaN(U)){throw new w.exception("arg",w.str.format("$.money requires a number. Passed {0}",U))}var Q=U.toString().split(/\./),S=Q[0],T=Q[1];function P(V){return(U<0)?-V:V}this._cents=(w.exists(T))?P(parseFloat("."+T)):0;this._dollars=parseInt(S);this._type=R||"$";this._value=U}D.prototype={cents:function(){return this._cents},dollars:function(){return this._dollars},type:function(){return this._type},value:function(){return this._value},add:function(P){money_checkType(this,P);return new D(this._value+P.value())},divide:function(P){if(!w.isNumber(P)){throw new Error()}return new D(this._value/P)},equals:function(P){return(this.isOfType(P))&&(this._value==P.value())},isOfType:function(P){return this._type==P.type()},isGreaterThan:function(P){money_checkType(this,P);return this._value>P.value()},isLessThan:function(P){money_checkType(this,P);return this._value<P.value()},multiply:function(P){if(!w.isNumber(P)){throw new Error()}return new D(this._value*P)},round:function(){return new D(w.math.round(this.value,-2))},roundDown:function(){return new D(w.math.roundDown(this.value,-2))},roundUp:function(){return new D(w.math.roundUp(this.value,-2))},subtract:function(P){money_checkType(this,P);return new D(this._value-P.value())},toString:function(){var P=(this.value<0)?"({0}{1}.{2})":"{0}{1}.{2}";return w.str.format(P,this._type,money_formatDollars(this),money_formatCents(this))}};w.money=function(Q,P){return new D(Q,P)};w.money.zero=function(){return w.money(0)};w.money.isMoney=function(P){return P instanceof D};w.money.canParse=function(P){try{w.money.parse(P);return true}catch(Q){return false}};w.money.parse=function(V){if(w.isNumber(V)){return w.money(V)}var P=/(\(.*\))|(\-)/.test(V),T=(P)?1:0,S=V.match(/[^\d\.\,\-]/g)||[],R=w.exists(S[T])?S[T]:"$",W=parseFloat(V.replace(/[^\d\.]/g,"")),Q=(P)?-W:W;return w.money(Q,R)};w.money.tryParse=function(P){return w.money.canParse(P)?w.money.parse(P):null};money_checkType=function(Q,P){if(!Q.isOfType(P)){throw new w.exception("operation","Invalid operation on non-conforming currencies.")}};money_formatDollars=function(P){var Q=P.dollars(),S=(P.cents()>=0.995)?(Q+1):Q,X=S.toString(),U=X.replace(/\-/,"").split(/\B/).reverse(),R=U.length,V=R>3,T=0,W=[];while(T<R){W[W.length]=U[T];T++;if(!w.exists(U[T])){break}if((T%3==0)&&V){W[W.length]=","}}return w.str.build.apply(this,W.reverse())};money_formatCents=function(R){var S=w.math.round(R.cents(),-3),Q=S.toString(),T=Q.replace(/\-|(0\.)/g,"").concat("0").split(/\B/),P=T.length;if(w.isZero(P)||S>=0.995){return"00"}if(P<2){return"0"+T[0]}return(parseInt(T[2])>4)?T[0]+(parseInt(T[1])+1):T[0]+T[1]};function o(P,Q){if(!w.isNumber(P)||!w.isNumber(Q)){throw new Error(w.str.format("at $.coord({0},{1})",P,Q))}o.base.call(this);this.x(P).y(Q)}o.prototype={x:function(P){return this.property("x",P)},y:function(P){return this.property("y",P)},abs:function(){return new o(Math.abs(this._x),Math.abs(this._y))},add:function(Q){var P=this._x+Q.x(),R=this._y+Q.y();return new o(P,R)},divide:function(Q){var P=this._x/Q.x(),R=this._y/Q.y();return new o(P,R)},equals:function(P){return(this._x===P.x())&&(this._y===P.y())},multiply:function(Q){var P=this._x*Q.x(),R=this._y*Q.y();return new o(P,R)},subtract:function(Q){var P=this._x-Q.x(),R=this._y-Q.y();return new o(P,R)},round:function(P){var Q=P||0;return new o(w.math.round(this.x(),Q),w.math.round(this.y(),Q))},half:function(){return this.divide(new o(2,2))},value:function(){return{x:this._x,y:this._y}},toEm:function(){return z(this,"em")},toPixel:function(){return z(this,"px")},toString:function(){return w.str.format("({0},{1})",this._x,this._y)}};w.Class.extend(o,w.Class);w.coord=function(P,Q){return new o(P,Q)};w.coord.Class=o;function z(Q,P){return{x:function(){return Q.x()+P},y:function(){return Q.y()+P}}}function B(P){try{if(("left" in P)&&("top" in P)){return !isNaN(P.left)&&!isNaN(P.top)}if(("width" in P)&&("height" in P)){return !isNaN(P.width)&&!isNaN(P.height)}return false}catch(Q){return false}}function f(P){if(("left" in P)&&("top" in P)){return new o(P.left,P.top)}if(("width" in P)&&("height" in P)){return new o(P.width,P.height)}return null}w.coord.zero=function(){return new o(0,0)};w.coord.random=function(R,Q){var P=R*Math.random(),S=Q*Math.random(Q);return new o(P,S)};w.coord.canParse=f;w.coord.parse=f;w.coord.tryParse=function(P){return B(P)?f(P):null};function y(P,Q){y.base.call(this,P,Q)}y.prototype={isAbove:function(P){return this.y()<P.y()},isBelow:function(P){return this.y()>P.y()},isLeftOf:function(P){return this.x()<P.x()},isRightOf:function(P){return this.x()>P.x()},distanceFrom:function(P){return w.vector(this.x()-P.x(),this.y()-P.y())},distanceTo:function(P){return this.distanceFrom(P).invert()}};w.Class.extend(y,w.coord.Class);w.point=function(P,Q){return new y(P,Q)};w.point.Class=y;w.point.zero=function(){return new y(0,0)};w.point.canParse=u;w.point.parse=a;w.point.tryParse=function(P){return u(P)?a(P):null};function u(P){try{return !isNaN(P.x())&&!isNaN(P.y())}catch(Q){return false}}function a(P){return new y(P.x(),P.y())}function L(P,Q){L.base.call(this);this._topLeft=w.point.parse(P);this._dims=w.point.parse(Q);this._bottomRight=w.point.parse(P.add(Q))}L.prototype={dims:function(){return this.get("dims")},topLeft:function(){return this.get("topLeft")},bottomRight:function(){return this.get("bottomRight")},center:function(){return this._topLeft.add(this._bottomRight.subtract(this._topLeft)).half()},contains:function(R){var Q=this._topLeft,P=this._bottomRight;return Q.isAbove(R)&&Q.isLeftOf(R)&&P.isRightOf(R)&&P.isBelow(R)}};w.Class.extend(L,w.Class);w.rectangle=function(Q,P){return new L(Q,P)};function b(P,Q){if(!w.isNumber(P)||!w.isNumber(Q)){throw w.exception("args",w.str.format("at $.vector({0},{1})",P,Q))}b.base.call(this,P,Q);this._lengthSquared=c(this,P,Q);this._length=m(this,this._lengthSquared);this._unitNormalX=A(this,P);this._unitNormalY=A(this,Q)}b.prototype={magnatude:function(){return this.get("length")},equals:function(P){return(P instanceof b)&&((this._x===P.x())&&(this._y===P.y()))},normal:function(){return w.vector(this._unitNormalX,this._unitNormalY)},invert:function(){return w.vector(this.x()*-1,this.y()*-1)},norm:function(){return w.vector(Math.abs(this.x()),Math.abs(this.y()))},perpendicular:function(){return w.vector(this.y()*-1,this.x())},isZero:function(){return this.x()==0&&this.y()==0},add:function(P){return w.vector(this.x()+P.x(),this.y()+P.y())},dot:function(P){return(this.x()*P.x())+(this.y()*P.y())},perpendicularAtTo:function(P){var Q=P.add(this.projectionOfOnto(P).invert());return w.vector(Q.x(),Q.y())},projectionOfOnto:function(P){var Q=P.normal().scale(this.dot(P.normal()));return w.vector(Q.x(),Q.y())},scale:function(P){return w.vector((this.x()*P),(this.y()*P))},unitNormalDot:function(P){return(this.normal().x()*P.normal().x())+(this.normal().y()*P.normal().y())},reflect:function(P){if(P.isZero()){return this}var Q=P.normal();return this.add(Q.scale(2*(Q.dot(this))).invert())},round:function(P){var Q=P||0;return w.vector(w.math.round(this.x(),Q),w.math.round(this.y(),Q))}};w.Class.extend(b,w.coord.Class);w.vector=function(P,Q){return new b(P,Q)};w.vector.Class=b;w.vector.zero=function(){return w.vector(0,0)};w.vector.random=function(R,Q){var P=R*Math.random(),S=Q*Math.random();return w.vector(P,S)};function m(P,Q){if(P.isZero()){return 0}return Math.sqrt(Q)}function c(Q,P,R){if(Q.isZero()){return 0}return Math.pow(P,2)+Math.pow(R,2)}function A(Q,P){if(Q.isZero()){return 0}return P/Q.magnatude()}w.abstractContext=function(P){w.abstractContext.base.call(this);this.state(P)};w.abstractContext.prototype={state:function(P){if(!w.exists(P)){return this._state}return this.set("state",P.context(this))}};w.Class.extend(w.abstractContext,w.Class);w.abstractState=function(P){w.abstractState.base.call(this);this.states(P)};w.abstractState.prototype={context:function(P){return this.property("context",P)},states:function(P){return this.set("states",P)},state:function(P){var Q=this._context;Q.state(new this._states[P](Q));return this}};w.Class.extend(w.abstractState,w.Class);w.abstractVisitor=function(){};w.abstractVisitor.prototype={$visit:function(){throw new Error("visit method is abstract an must be defined.")},subject:function(P){return this.property("subject",w.replicate(P))},visit:function(){return this.$visit()}};function q(P){q.base.call(this);this.$current=0;this._quit=false;this.subject(P)}q.prototype={$hasNext:function(){return w.exists(this._subject[this.$current+1])},$hasPrev:function(){return w.exists(this._subject[this.$current-1])},$each:function(Q,R){var P=R||this;this.reset();do{Q.call(P,this.current())}while(this.next()&&(!this._quit));this._end=false;this.reset()},$exec:function(R){var P=this._subject,Q=P[R];if(!w.exists(Q)){return null}this.$current=R;return Q},subject:function(Q){var P=(w.isArray(Q))?Q:(w.isObject(Q))?g(Q):Q;if(!w.isUndefined(Q)){this.reset()}this.$subject=P;return this.property("subject",P)},current:function(){return this.$exec(this.$current)},next:function(){return this.$exec(this.$current+1)},prev:function(){return this.$exec(this.$current-1)},hasNext:function(){return this.$hasNext()},hasPrev:function(){return this.$hasPrev()},reset:function(){this.$current=0;return this},quit:function(){return this.set("quit",true)},each:function(P,Q){if(this._subject.length<1){return this}this.$each(P,Q);return this}};function g(P){var Q=[];for(n in P){Q.push({key:n,value:P[n]})}return Q}w.Class.extend(q,w.Class);w.iterator=function(P){return new q(P)};w.iterator.Class=q;function v(){v.base.call(this);this._observers=w.hash()}v.prototype={subscribe:function(P,T,Q,S){var R=this._observers;if(R.containsKey(P)){R.find(P).add(T,Q,S)}else{R.add(P,w.observer().add(T,Q,S))}return this},unsubscribe:function(P,R){var Q=this._observers;if(Q.containsKey(P)){Q.find(P).remove(R)}return this},notify:function(){var S=w.list.parseArguments(arguments),P=S.find(0),R=!this._observers.containsKey(P),Q=!R||(S.count()>1),T=R?P:null,U=R?S.remove(P):S;return(Q)?this._notify(T,U):this._notifyAll(T);return this},clear:function(){this._observers.each(function(P){P.value.clear()}).clear();return this},isEmpty:function(){return this._observers.isEmpty()},_notifyAll:function(P){this._observers.listValues().each(function(Q){Q.notify(P)});return this},_notify:function(Q,P){var R=this._observers;P.each(function(S){try{R.find(S).notify(Q)}catch(T){w.kulog(T)}});return this}};w.Class.extend(v,w.Class);w.mediator=function(){return new v()};w.mediator.Class=v;function x(){x.base.call(this);this._methods=new w.hash()}x.prototype={add:function(T,Q,S){var P=S||w.uid("observerMethod"),R=Q||this;this._methods.add(P,{m:T,s:R});return this},remove:function(P){this._methods.remove(P);return this},clear:function(){this._methods.clear();return this},notify:function(){var Q=new w.iterator(this._methods.listValues().toArray()),P=arguments;Q.each(function(R){w.refcheck(R.m).apply(R.s,P)});return this},isEmpty:function(){return this._methods.isEmpty()}};w.Class.extend(x,w.Class);w.observer=function(){return new x()};w.observer.Class=x;function h(){this._q=[]}h.prototype={isEmpty:function(){return this._q.length==0},enqueue:function(P){var Q=this._q;Q[Q.length]=P;return this},dequeue:function(){var Q=this._q,P=Q[0];Q.splice(0,1);return P},clear:function(){this._q=[]}};w.queue=function(){return new h()};w.queue.Class=h;function E(P){E.base.call(this,P)}E.prototype={$hasNext:function(){var R=this.$subject,P=R.length-1,T=this.$current,S=T+1,Q=(S>P)?0:S;return w.exists(R[Q])},$hasPrev:function(){var R=this.$subject,P=R.length-1,T=this.$current,S=T+1,Q=(S<0)?P:S;return w.exists(R[Q])},$each:function(Q,R){var P=R||this;this.reset();do{Q.call(R,this.current())}while(this.next()&&(this.$current>0));this.reset()},$exec:function(R){var Q=this.$subject,P=(Q.length-1);this.$current=(R>P)?0:((R<0)?P:R);return Q[this.$current]}};w.Class.extend(E,w.iterator.Class);w.rolodex=function(P){return new E(P)};w.rolodex.Class=E;function M(){}M.prototype={$isSatisfiedBy:function(P){return},isSatisfiedBy:function(P){return this.$isSatisfiedBy(P)},and:function(P){return new C(this,P)},or:function(P){return new j(this,P)},xor:function(P){return new t(this,P)},not:function(){return new I(this)}};function C(Q,P){C.base.call(this);this.$1=Q;this.$2=P}C.prototype.$isSatisfiedBy=function(P){return this.$1.isSatisfiedBy(P)&&this.$2.isSatisfiedBy(P)};w.Class.extend(C,M);function j(Q,P){j.base.call(this);this.$1=Q;this.$2=P}j.prototype.$isSatisfiedBy=function(P){return this.$1.isSatisfiedBy(P)||this.$2.isSatisfiedBy(P)};w.Class.extend(j,M);function t(Q,P){t.base.call(this);this.$1=Q;this.$2=P}t.prototype.$isSatisfiedBy=function(P){return w.xor(this.$1.isSatisfiedBy(P),this.$2.isSatisfiedBy(P))};w.Class.extend(t,M);function k(){k.base.call(this)}k.prototype.$isSatisfiedBy=function(P){return true};w.Class.extend(k,M);function e(){e.base.call(this)}e.prototype.$isSatisfiedBy=function(P){return false};w.Class.extend(e,M);function I(P){I.base.call(this);this._s=P}I.prototype.$isSatisfiedBy=function(P){return !this._s.isSatisfiedBy(P)};w.Class.extend(I,M);function l(P){l.base.call(this);this.$isSatisfiedBy=P}w.Class.extend(l,M);w.spec=function(P){return new l(P)};function s(){this._q=[]}s.prototype={isEmpty:function(){return this._q.length==0},push:function(P){var Q=this._q;Q[Q.length]=P;return this},pop:function(){return this._q.pop()},clear:function(){this._q=[]}};w.stack=function(){return new s()};w.stack.Class=s})(jQuery);