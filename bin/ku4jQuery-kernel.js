//kodmunki utilities
(function(w){w.isArray=function(O){return O instanceof Array};w.isBool=function(O){return(/boolean/i.test(typeof(O)))};w.isDate=function(O){return O instanceof Date};w.isEvent=function(O){try{return O instanceof Event}catch(P){return O===window.event}};w.isNumber=function(O){return(/number/i.test(typeof(O)))&&!isNaN(O)};w.isObject=function(O){return w.exists(O)&&(/object/i.test(typeof(O)))};w.isFunction=function(O){return(O instanceof Function)};w.isString=function(O){return(/string/i.test(typeof(O)))||O instanceof String};w.isZero=function(O){return O===0};w.isEven=function(O){return(w.isNullOrEmpty(O)||w.isDate(O))?false:(isNaN(O)?false:(w.isZero(O)?false:O%2===0))};w.isOdd=function(O){return(w.isNullOrEmpty(O)||w.isDate(O))?false:(isNaN(O)?false:(w.isZero(O)?false:!w.isEven(O)))};w.isNull=function(O){return O===null};w.isUndefined=function(O){return(/undefined/i.test(typeof(O)))};w.isEmpty=function(O){return w.isString(O)&&w.isZero(O.split(/\B/).length)};w.isNullOrEmpty=function(O){return !w.exists(O)||w.isEmpty(O)};w.exists=function(O){return(O!==null)&&(!w.isUndefined(O))};w.xor=function(P,O){return !P!=!O};w.replicate=function(Q){var O=(w.isDate(Q))?new Date(Q):(w.isArray(Q))?[]:(w.isObject(Q))?{}:Q,P;for(n in Q){P=Q[n];O[n]=((w.isArray(P))||(w.isObject(P)))?w.replicate(P):P}return O};if(!w.exists(w.obj)){w.obj={}}w.obj.keys=function(P){var O=[];for(n in P){O[O.length]=n}return O};w.obj.values=function(P){var O=[];for(n in P){O[O.length]=P[n]}return O};w.obj.count=function(O){var P=0;for(n in O){P++}return P};w.obj.hasProp=function(O,P){return(w.exists(O.hasOwnProperty))?O.hasOwnProperty(P):false};w.obj.merge=function(P,O){var Q=w.replicate(O);for(n in P){Q[n]=P[n]}return Q};w.obj.meld=function(Q,P){var O=w.replicate(P);for(n in Q){if(w.exists(O[n])){continue}O[n]=Q[n]}return O};w.Class=function(){};w.Class.prototype={get:function(O){return this["_"+O]},set:function(P,O){this["_"+P]=O;return this},property:function(P,O){return(w.isUndefined(O))?this.get(P):this.set(P,O)}};w.Class.extend=function(P,O){if(!P||!O){return null}var Q=function(){};Q.prototype=O.prototype;P.base=O;P.prototype=w.obj.merge(P.prototype,new Q());P.prototype.constructor=P;return P};function d(O){d.base.call(this);this._isLocked=O||false}d.prototype={isLocked:function(){return this.get("isLocked")},lock:function(){this._isLocked=true},unlock:function(){this._isLocked=false}};w.Class.extend(d,w.Class);w.lock=function(O){return new d(O)};if(!w.exists(w.math)){w.math={}}w.math.round=function(R,Q){var P=Q||0,O=Math.pow(10,-P);return Math.round(parseFloat((R*O).toFixed(Math.abs(P))))/O};w.math.roundUp=function(R,Q){var P=Q||0,O=5*(Math.pow(10,P-1));return w.math.round(R+O,Q)};w.math.roundDown=function(R,Q){var P=Q||0,O=5*(Math.pow(10,P-1));return w.math.round(R-O,Q)};w.math.factorial=function(Q){var O=Q,P=Q;while(P--){if(!!P){O*=P}}return O};w.math.divide=function(P,O){var Q=w.isNumber(P)&&w.isNumber(O)&&!w.isZero(O);if(!Q){throw new Error(w.str.format("Invalid division. value: {0}/{1} | type: {2}/{3}",P,O,typeof P,typeof O))}return P/O};if(!w.exists(w.str)){w.str={}}w.str.build=function(){return"".concat.apply(new String(),arguments)};w.str.format=function(){var Q=arguments,T=Q[0],P=Q.length,O,R;for(i=1;i<P;i++){O=Q[i];R=(w.isNull(O))?"null":(w.isUndefined(O))?"undefined":O.toString();T=T.replace(RegExp("\\{"+(i-1)+"\\}","g"),R)}return T};w.str.parse=function(){return String.fromCharCode.apply(String,arguments)};w.str.trim=function(O){return w.str.trimStart(w.str.trimEnd(O))};w.str.trimStart=function(O){if(!w.isString(O)){throw new Error("Cannot trim non-string values")}return(w.exists(O.replace))?O.replace(/^\s*\b/,""):O};w.str.trimEnd=function(O){if(!w.isString(O)){throw new Error("Cannot trim non-string values")}return(w.exists(O.replace))?O.replace(/\b\s*$/,""):O};w.kuid=function(Q){var P=Q||"kuid",O=Math.random().toString().replace(/\b\.\b/,"");return w.str.format("{0}{1}",P,O)};function H(O){H.base.call(this);var P=(!w.exists(O)||!O.toObject)?O:O.toObject();this.$h=(w.exists(P))?P:{};this._count=0;for(n in this.$h){this._count++}}H.prototype={count:function(){return this.get("count")},add:function(P,O){if(!w.exists(P)||this.containsKey(P)){return this}this.$h[P]=O;this._count++;return this},clear:function(){var O=this.$h;for(n in O){delete O[n]}this._count=0;return this},find:function(O){if(!w.exists(O)){return null}return this.$h[O]},findKey:function(O){if(!w.exists(O)){return null}var P=this.$h;for(n in P){if(P[n]==O){return n}}return null},findValue:function(O){return this.find(O)},quit:function(){this._iterator.quit();return this},each:function(P,O){var Q=O||this;this._iterator=w.iterator(this.toObject());this._iterator.each(P,Q);return this},isEmpty:function(){return this._count<1},listKeys:function(){return new w.list(w.obj.keys(this.$h))},listValues:function(){return new w.list(w.obj.values(this.$h))},containsKey:function(O){if(!w.exists(O)){return false}return w.exists(this.$h[O])},containsValue:function(P){var O=w.obj.values(this.$h),Q=O.length;while(Q--){if(O[Q]==P){return true}}return false},merge:function(O){return G(this,O,"merge")},meld:function(O){return G(this,O,"meld")},remove:function(O){var P=this.$h;if(!w.exists(O)||!w.exists(P[O])){return this}delete P[O];this._count--;return this},replicate:function(){return w.hash(w.replicate(this.$h))},toObject:function(){return this.$h},update:function(P,O){if(!w.exists(P)){return this}if(!this.containsKey(P)){this._count++}this.$h[P]=O;return this}};w.Class.extend(H,w.Class);function G(Q,P,O){var R=(!P.toObject)?P:P.toObject();Q.$h=w.obj[O](R,Q.$h);Q._count=w.obj.count(Q.$h);return Q}w.hash=function(O){return new H(O)};w.hash.Class=H;function r(P){r.base.call(this);this._keys=[];this._hash=w.hash();this._count=this._keys.length;if(!w.exists(P)){return}var Q=0,O=P.length;while(Q<O){this.add(P[Q]);Q++}}r.prototype={count:function(){return this.get("count")},add:function(P){var O=this._keys,Q=w.uid();O[O.length]=Q;this._hash.add(Q,P);this._count=this._keys.length;return this},clear:function(){this._hash.clear();this._keys=[];this._count=this._keys.length;return this},contains:function(O){return this._hash.containsValue(O)},find:function(P){var O=this._keys;return(w.exists(O[P]))?this._hash.find(O[P]):null},quit:function(){this._iterator.quit();return this},each:function(P,O){var Q=O||this;this._iterator=w.iterator(this.toArray());this._iterator.each(P,Q);return this},isEmpty:function(){return this._count<1},remove:function(Q){var P=this._hash,O;if(!this.contains(Q)){return this}O=P.findKey(Q);this._keys.splice(O,1);P.remove(O);this._count=P.count();return this},toArray:function(){var O=[];this._hash.each(function(P){O.push(P.value)});return O},sort:function(O){var Q=this.toArray().sort(O);this.clear();var R=0,P=Q.length;while(R<P){this.add(Q[R]);R++}return this}};w.Class.extend(r,w.Class);w.list=function(O){return new r(O)};w.list.Class=r;w.list.parseArguments=function(O){return new r(Array.prototype.slice.call(O))};function J(T,R,O,U,Q,V,P){if((R<1)||(R>12)){throw new w.exception("arg","Invalid month at $.dayPoint")}if((O<1)||(O>M(R,T))){throw new w.exception("arg","Invalid date at $.dayPoint")}this._value=(arguments.length>=3)?new Date(T,R-1,O,U||0,Q||0,V||0,P||0):new Date();var W=this._value;function X(Y){return Y<10?"0"+Y:""+Y}this._day=W.getDay();this._date=O;this._month=R;this._year=T;this._hour=X(W.getHours());this._minute=X(W.getMinutes());this._second=X(W.getSeconds());this._millisecond=X(W.getMilliseconds());var S=this._day;this._isWeekday=S>0&&S<6;this._isWeekend=!this._isWeekday}J.prototype={value:function(){return this._value},day:function(){return this._day},date:function(){return this._date},month:function(){return this._month},year:function(){return this._year},hour:function(){return this._hour},minute:function(){return this._minute},second:function(){return this._second},millisecond:function(){return this._millisecond},isWeekday:function(){return this._isWeekday},isWeekend:function(){return this._isWeekend},equals:function(O){return this._value==O.value()},nextDay:function(){return N(this,1,0,0)},prevDay:function(){return N(this,-1,0,0)},nextMonth:function(){return N(this,0,1,0)},prevMonth:function(){return N(this,0,-1,0)},nextYear:function(){return N(this,0,0,1)},prevYear:function(){return N(this,0,0,-1)},add:function(T,O,Y){function X(aa,ae,ad){var ab=aa,ac=ae;while(ac--){ab=ab[ad]()}return ab}var W=T<0,Z=Math.abs,V=Z(T),U=Z(Y),Q=Z(O),P=W?"prevYear":"nextYear",S=W?"prevDay":"nextDay",R=W?"prevMonth":"nextMonth";return X(X(X(this,V,P),Q,R),U,S)},firstDayOfMonth:function(){return new J(this._year,this._month,1)},lastDayOfMonth:function(){return new J(this._year,this._month,M(this._month,this._year))},isBefore:function(O){return !(this.isAfter(O)||this.equals(O))},isAfter:function(P){var O=this._year,R=P.year(),Q=this._month,S=P.month();if(O>R){return true}if((O==R)&&(Q>S)){return true}if((O==R)&&(Q==S)&&(this._date>P.date())){return true}return false},equals:function(O){return(this._year==O.year())&&(this._month==O.month())&&(this._date==O.date())},toString:function(){var R=this._year,O=this._month,Q=this._date,P=(O<10&&Q<10)?"0{1}/0{2}/{0}":(O<10)?"0{1}/{2}/{0}":(Q<10)?"{1}/0{2}/{0}":"{1}/{2}/{0}";return w.str.format(P,R,O,Q)},toDate:function(){return this.value()}};w.dayPoint=function(S,T,Q,O,R,U,P){if(!(w.isDate(S)||(w.isNumber(S)&&w.isNumber(T)&&w.isNumber(Q)))){return null}return new J(S,T,Q,O,R,U,P)};w.dayPoint.canParse=function(O){return(w.isString(O)||w.isNumber(O)||w.isDate(O))?!isNaN(new Date(O).valueOf()):false};w.dayPoint.parse=function(V){if(V instanceof J){return V}if(!(w.isDate(V)||this.canParse(V))){return null}var O=new Date(V),U=O.getFullYear(),Q=O.getMonth()+1,T=O.getDate(),R=O.getHours(),S=O.getMinutes(),W=O.getSeconds(),P=O.getMilliseconds();return w.dayPoint(U,Q,T,R,S,W,P)};w.dayPoint.tryParse=function(O){return w.dayPoint.canParse(O)?w.dayPoint.parse(O):null};var F;w.dayPoint.assumeNow=function(O){F=w.dayPoint.parse(O)};w.dayPoint.today=function(){return F||w.dayPoint.parse(new Date())};function M(Q,P){var O=Q,R=P;if(O==2){return(p(R))?29:28}return(((O<8)&&(w.isEven(O)))||((O>7)&&(w.isOdd(O))))?30:31}function p(O){var Q=O.toString().split(/\B/),P=parseFloat(w.str.build(Q[Q.length-2],Q[Q.length-1]));return(P%4==0)}function N(U,Z,Q,ab){var ad=U.month(),V=U.year(),S=U.date(),O=M(ad,V),ac=Z,T=Q,Y=ab,P=S+ac,X=ad+T,aa=V+Y;if((S+ac)>O){P=1;X=(ad+(T+1))}if((S+ac)<1){var R=U.prevMonth(),P=M(R.month(),R.year());(X=ad+(T-1))}if((X)>12){X=1;aa=(V+(Y+1))}if((X)<1){X=12;aa=(V+(Y-1))}var W=M(X,aa);P=(P>W)?W:P;return new J(aa,X,P)}function D(T,Q){if(isNaN(T)){throw new w.exception("arg",w.str.format("$.money requires a number. Passed {0}",T))}var P=T.toString().split(/\./),R=P[0],S=P[1];function O(U){return(T<0)?-U:U}this._cents=(w.exists(S))?O(parseFloat("."+S)):0;this._dollars=parseInt(R);this._type=Q||"$";this._value=T}D.prototype={cents:function(){return this._cents},dollars:function(){return this._dollars},type:function(){return this._type},value:function(){return this._value},add:function(O){money_checkType(this,O);return new D(this._value+O.value())},divide:function(O){if(!w.isNumber(O)){throw new Error()}return new D(this._value/O)},equals:function(O){return(this.isOfType(O))&&(this._value==O.value())},isOfType:function(O){return this._type==O.type()},isGreaterThan:function(O){money_checkType(this,O);return this._value>O.value()},isLessThan:function(O){money_checkType(this,O);return this._value<O.value()},multiply:function(O){if(!w.isNumber(O)){throw new Error()}return new D(this._value*O)},round:function(){return new D(w.math.round(this.value,-2))},roundDown:function(){return new D(w.math.roundDown(this.value,-2))},roundUp:function(){return new D(w.math.roundUp(this.value,-2))},subtract:function(O){money_checkType(this,O);return new D(this._value-O.value())},toString:function(){var O=(this.value<0)?"({0}{1}.{2})":"{0}{1}.{2}";return w.str.format(O,this._type,money_formatDollars(this),money_formatCents(this))}};w.money=function(P,O){return new D(P,O)};w.money.zero=function(){return w.money(0)};w.money.isMoney=function(O){return O instanceof D};w.money.canParse=function(O){try{w.money.parse(O);return true}catch(P){return false}};w.money.parse=function(T){if(w.isNumber(T)){return w.money(T)}var O=/(\(.*\))|(\-)/.test(T),S=(O)?1:0,R=T.match(/[^\d\.\,\-]/g)||[],Q=w.exists(R[S])?R[S]:"$",V=parseFloat(T.replace(/[^\d\.]/g,"")),P=(O)?-V:V;return w.money(P,Q)};w.money.tryParse=function(O){return w.money.canParse(O)?w.money.parse(O):null};money_checkType=function(P,O){if(!P.isOfType(O)){throw new w.exception("operation","Invalid operation on non-conforming currencies.")}};money_formatDollars=function(O){var P=O.dollars(),R=(O.cents()>=0.995)?(P+1):P,W=R.toString(),T=W.replace(/\-/,"").split(/\B/).reverse(),Q=T.length,U=Q>3,S=0,V=[];while(S<Q){V[V.length]=T[S];S++;if(!w.exists(T[S])){break}if((S%3==0)&&U){V[V.length]=","}}return w.str.build.apply(this,V.reverse())};money_formatCents=function(Q){var R=w.math.round(Q.cents(),-3),P=R.toString(),S=P.replace(/\-|(0\.)/g,"").concat("0").split(/\B/),O=S.length;if(w.isZero(O)||R>=0.995){return"00"}if(O<2){return"0"+S[0]}return(parseInt(S[2])>4)?S[0]+(parseInt(S[1])+1):S[0]+S[1]};function o(O,P){if(!w.isNumber(O)||!w.isNumber(P)){throw new Error(w.str.format("at $.coord({0},{1})",O,P))}o.base.call(this);this.x(O).y(P)}o.prototype={x:function(O){return this.property("x",O)},y:function(O){return this.property("y",O)},abs:function(){return new o(Math.abs(this._x),Math.abs(this._y))},add:function(P){var O=this._x+P.x(),Q=this._y+P.y();return new o(O,Q)},divide:function(P){var O=this._x/P.x(),Q=this._y/P.y();return new o(O,Q)},equals:function(O){return(this._x===O.x())&&(this._y===O.y())},multiply:function(P){var O=this._x*P.x(),Q=this._y*P.y();return new o(O,Q)},subtract:function(P){var O=this._x-P.x(),Q=this._y-P.y();return new o(O,Q)},round:function(O){var P=O||0;return new o(w.math.round(this.x(),P),w.math.round(this.y(),P))},half:function(){return this.divide(new o(2,2))},value:function(){return{x:this._x,y:this._y}},toEm:function(){return z(this,"em")},toPixel:function(){return z(this,"px")},toString:function(){return w.str.format("({0},{1})",this._x,this._y)}};w.Class.extend(o,w.Class);w.coord=function(O,P){return new o(O,P)};w.coord.Class=o;function z(P,O){return{x:function(){return P.x()+O},y:function(){return P.y()+O}}}function B(O){try{if(("left" in O)&&("top" in O)){return !isNaN(O.left)&&!isNaN(O.top)}if(("width" in O)&&("height" in O)){return !isNaN(O.width)&&!isNaN(O.height)}return false}catch(P){return false}}function e(O){if(("left" in O)&&("top" in O)){return new o(O.left,O.top)}if(("width" in O)&&("height" in O)){return new o(O.width,O.height)}return null}w.coord.zero=function(){return new o(0,0)};w.coord.random=function(Q,P){var O=Q*Math.random(),R=P*Math.random(P);return new o(O,R)};w.coord.canParse=e;w.coord.parse=e;w.coord.tryParse=function(O){return B(O)?e(O):null};function y(O,P){y.base.call(this,O,P)}y.prototype={isAbove:function(O){return this.y()<O.y()},isBelow:function(O){return this.y()>O.y()},isLeftOf:function(O){return this.x()<O.x()},isRightOf:function(O){return this.x()>O.x()},distanceFrom:function(O){return w.vector(this.x()-O.x(),this.y()-O.y())},distanceTo:function(O){return this.distanceFrom(O).invert()}};w.Class.extend(y,w.coord.Class);w.point=function(O,P){return new y(O,P)};w.point.Class=y;w.point.zero=function(){return new y(0,0)};w.point.canParse=u;w.point.parse=a;w.point.tryParse=function(O){return u(O)?a(O):null};function u(O){try{return !isNaN(O.x())&&!isNaN(O.y())}catch(P){return false}}function a(O){return new y(O.x(),O.y())}function K(O,P){K.base.call(this);this._topLeft=w.point.parse(O);this._dims=w.point.parse(P);this._bottomRight=w.point.parse(O.add(P))}K.prototype={dims:function(){return this.get("dims")},topLeft:function(){return this.get("topLeft")},bottomRight:function(){return this.get("bottomRight")},center:function(){return this._topLeft.add(this._bottomRight.subtract(this._topLeft)).half()},contains:function(Q){var P=this._topLeft,O=this._bottomRight;return P.isAbove(Q)&&P.isLeftOf(Q)&&O.isRightOf(Q)&&O.isBelow(Q)}};w.Class.extend(K,w.Class);w.rectangle=function(P,O){return new K(P,O)};function b(O,P){if(!w.isNumber(O)||!w.isNumber(P)){throw w.exception("args",w.str.format("at $.vector({0},{1})",O,P))}b.base.call(this,O,P);this._lengthSquared=c(this,O,P);this._length=m(this,this._lengthSquared);this._unitNormalX=A(this,O);this._unitNormalY=A(this,P)}b.prototype={magnatude:function(){return this.get("length")},equals:function(O){return(O instanceof b)&&((this._x===O.x())&&(this._y===O.y()))},normal:function(){return w.vector(this._unitNormalX,this._unitNormalY)},invert:function(){return w.vector(this.x()*-1,this.y()*-1)},norm:function(){return w.vector(Math.abs(this.x()),Math.abs(this.y()))},perpendicular:function(){return w.vector(this.y()*-1,this.x())},isZero:function(){return this.x()==0&&this.y()==0},add:function(O){return w.vector(this.x()+O.x(),this.y()+O.y())},dot:function(O){return(this.x()*O.x())+(this.y()*O.y())},perpendicularAtTo:function(O){var P=O.add(this.projectionOfOnto(O).invert());return w.vector(P.x(),P.y())},projectionOfOnto:function(O){var P=O.normal().scale(this.dot(O.normal()));return w.vector(P.x(),P.y())},scale:function(O){return w.vector((this.x()*O),(this.y()*O))},unitNormalDot:function(O){return(this.normal().x()*O.normal().x())+(this.normal().y()*O.normal().y())},reflect:function(O){if(O.isZero()){return this}var P=O.normal();return this.add(P.scale(2*(P.dot(this))).invert())},round:function(O){var P=O||0;return w.vector(w.math.round(this.x(),P),w.math.round(this.y(),P))}};w.Class.extend(b,w.coord.Class);w.vector=function(O,P){return new b(O,P)};w.vector.Class=b;w.vector.zero=function(){return w.vector(0,0)};w.vector.random=function(Q,P){var O=Q*Math.random(),R=P*Math.random();return w.vector(O,R)};function m(O,P){if(O.isZero()){return 0}return Math.sqrt(P)}function c(P,O,Q){if(P.isZero()){return 0}return Math.pow(O,2)+Math.pow(Q,2)}function A(P,O){if(P.isZero()){return 0}return O/P.magnatude()}w.abstractContext=function(O){w.abstractContext.base.call(this);this.state(O)};w.abstractContext.prototype={state:function(O){if(!w.exists(O)){return this._state}return this.set("state",O.context(this))}};w.Class.extend(w.abstractContext,w.Class);w.abstractState=function(O){w.abstractState.base.call(this);this.states(O)};w.abstractState.prototype={context:function(O){return this.property("context",O)},states:function(O){return this.set("states",O)},state:function(O){var P=this._context;P.state(new this._states[O](P));return this}};w.Class.extend(w.abstractState,w.Class);w.abstractVisitor=function(){};w.abstractVisitor.prototype={$visit:function(){throw new Error("visit method is abstract an must be defined.")},subject:function(O){return this.property("subject",w.replicate(O))},visit:function(){return this.$visit()}};function q(O){q.base.call(this);this.$current=0;this._quit=false;this.subject(O)}q.prototype={$hasNext:function(){return w.exists(this._subject[this.$current+1])},$hasPrev:function(){return w.exists(this._subject[this.$current-1])},$each:function(P,Q){var O=Q||this;this.reset();do{P.call(O,this.current())}while(this.next()&&(!this._quit));this._end=false;this.reset()},$exec:function(Q){var O=this._subject,P=O[Q];if(!w.exists(P)){return null}this.$current=Q;return P},subject:function(P){var O=(w.isArray(P))?P:(w.isObject(P))?g(P):P;if(!w.isUndefined(P)){this.reset()}this.$subject=O;return this.property("subject",O)},current:function(){return this.$exec(this.$current)},next:function(){return this.$exec(this.$current+1)},prev:function(){return this.$exec(this.$current-1)},hasNext:function(){return this.$hasNext()},hasPrev:function(){return this.$hasPrev()},reset:function(){this.$current=0;return this},quit:function(){return this.set("quit",true)},each:function(O,P){if(this._subject.length<1){return this}this.$each(O,P);return this}};function g(O){var P=[];for(n in O){P.push({key:n,value:O[n]})}return P}w.Class.extend(q,w.Class);w.iterator=function(O){return new q(O)};w.iterator.Class=q;function v(){v.base.call(this);this._observers=w.hash()}v.prototype={subscribe:function(O,S,P,R){var Q=this._observers;if(Q.containsKey(O)){Q.find(O).add(S,P,R)}else{Q.add(O,w.observer().add(S,P,R))}return this},unsubscribe:function(O,Q){var P=this._observers;if(P.containsKey(O)){P.find(O).remove(Q)}return this},notify:function(){var R=w.list.parseArguments(arguments),O=R.find(0),Q=!this._observers.containsKey(O),P=!Q||(R.count()>1),S=Q?O:null,T=Q?R.remove(O):R;return(P)?this._notify(S,T):this._notifyAll(S);return this},clear:function(){this._observers.each(function(O){O.value.clear()}).clear();return this},isEmpty:function(){return this._observers.isEmpty()},_notifyAll:function(O){this._observers.listValues().each(function(P){P.notify(O)});return this},_notify:function(P,O){var Q=this._observers;O.each(function(R){try{Q.find(R).notify(P)}catch(S){w.kulog(S)}});return this}};w.Class.extend(v,w.Class);w.mediator=function(){return new v()};w.mediator.Class=v;function x(){x.base.call(this);this._methods=new w.hash()}x.prototype={add:function(S,P,R){var O=R||w.uid("observerMethod"),Q=P||this;this._methods.add(O,{m:S,s:Q});return this},remove:function(O){this._methods.remove(O);return this},clear:function(){this._methods.clear();return this},notify:function(){var P=new w.iterator(this._methods.listValues().toArray()),O=arguments;P.each(function(Q){w.refcheck(Q.m).apply(Q.s,O)});return this},isEmpty:function(){return this._methods.isEmpty()}};w.Class.extend(x,w.Class);w.observer=function(){return new x()};w.observer.Class=x;function h(){this._q=[]}h.prototype={isEmpty:function(){return this._q.length==0},enqueue:function(O){var P=this._q;P[P.length]=O;return this},dequeue:function(){var P=this._q,O=P[0];P.splice(0,1);return O},clear:function(){this._q=[]}};w.queue=function(){return new h()};w.queue.Class=h;function E(O){E.base.call(this,O)}E.prototype={$hasNext:function(){var Q=this.$subject,O=Q.length-1,S=this.$current,R=S+1,P=(R>O)?0:R;return w.exists(Q[P])},$hasPrev:function(){var Q=this.$subject,O=Q.length-1,S=this.$current,R=S+1,P=(R<0)?O:R;return w.exists(Q[P])},$each:function(P,Q){var O=Q||this;this.reset();do{P.call(Q,this.current())}while(this.next()&&(this.$current>0));this.reset()},$exec:function(Q){var P=this.$subject,O=(P.length-1);this.$current=(Q>O)?0:((Q<0)?O:Q);return P[this.$current]}};w.Class.extend(E,w.iterator.Class);w.rolodex=function(O){return new E(O)};w.rolodex.Class=E;function L(){}L.prototype={$isSatisfiedBy:function(O){return},isSatisfiedBy:function(O){return this.$isSatisfiedBy(O)},and:function(O){return new C(this,O)},or:function(O){return new j(this,O)},xor:function(O){return new t(this,O)},not:function(){return new I(this)}};function C(P,O){C.base.call(this);this.$1=P;this.$2=O}C.prototype.$isSatisfiedBy=function(O){return this.$1.isSatisfiedBy(O)&&this.$2.isSatisfiedBy(O)};w.Class.extend(C,L);function j(P,O){j.base.call(this);this.$1=P;this.$2=O}j.prototype.$isSatisfiedBy=function(O){return this.$1.isSatisfiedBy(O)||this.$2.isSatisfiedBy(O)};w.Class.extend(j,L);function t(P,O){t.base.call(this);this.$1=P;this.$2=O}t.prototype.$isSatisfiedBy=function(O){return w.xor(this.$1.isSatisfiedBy(O),this.$2.isSatisfiedBy(O))};w.Class.extend(t,L);function k(){k.base.call(this)}k.prototype.$isSatisfiedBy=function(O){return true};w.Class.extend(k,L);function f(){f.base.call(this)}f.prototype.$isSatisfiedBy=function(O){return false};w.Class.extend(f,L);function I(O){I.base.call(this);this._s=O}I.prototype.$isSatisfiedBy=function(O){return !this._s.isSatisfiedBy(O)};w.Class.extend(I,L);function l(O){l.base.call(this);this.$isSatisfiedBy=O}w.Class.extend(l,L);w.spec=function(O){return new l(O)};function s(){this._q=[]}s.prototype={isEmpty:function(){return this._q.length==0},push:function(O){var P=this._q;P[P.length]=O;return this},pop:function(){return this._q.pop()},clear:function(){this._q=[]}};w.stack=function(){return new s()};w.stack.Class=s})(jQuery);